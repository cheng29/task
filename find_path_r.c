#include<stdio.h> 
#include<stdlib.h>
#include<time.h>

int test_round(int deep, int *T, unsigned long long int i);


char Tabel_mul[16][16]= {
{0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 },
{0 ,1 ,2 ,3 ,4 ,5 ,6 ,7 ,8 ,9 ,10 ,11 ,12 ,13 ,14 ,15 },
{0 ,2 ,4 ,6 ,8 ,10 ,12 ,14 ,3 ,1 ,7 ,5 ,11 ,9 ,15 ,13 },
{0 ,3 ,6 ,5 ,12 ,15 ,10 ,9 ,11 ,8 ,13 ,14 ,7 ,4 ,1 ,2 },
{0 ,4 ,8 ,12 ,3 ,7 ,11 ,15 ,6 ,2 ,14 ,10 ,5 ,1 ,13 ,9 },
{0 ,5 ,10 ,15 ,7 ,2 ,13 ,8 ,14 ,11 ,4 ,1 ,9 ,12 ,3 ,6 },
{0 ,6 ,12 ,10 ,11 ,13 ,7 ,1 ,5 ,3 ,9 ,15 ,14 ,8 ,2 ,4 },
{0 ,7 ,14 ,9 ,15 ,8 ,1 ,6 ,13 ,10 ,3 ,4 ,2 ,5 ,12 ,11 },
{0 ,8 ,3 ,11 ,6 ,14 ,5 ,13 ,12 ,4 ,15 ,7 ,10 ,2 ,9 ,1 },
{0 ,9 ,1 ,8 ,2 ,11 ,3 ,10 ,4 ,13 ,5 ,12 ,6 ,15 ,7 ,14 },
{0 ,10 ,7 ,13 ,14 ,4 ,9 ,3 ,15 ,5 ,8 ,2 ,1 ,11 ,6 ,12 },
{0 ,11 ,5 ,14 ,10 ,1 ,15 ,4 ,7 ,12 ,2 ,9 ,13 ,6 ,8 ,3 },
{0 ,12 ,11 ,7 ,5 ,9 ,14 ,2 ,10 ,6 ,1 ,13 ,15 ,3 ,4 ,8 },
{0 ,13 ,9 ,4 ,1 ,12 ,8 ,5 ,2 ,15 ,11 ,6 ,3 ,14 ,10 ,7 },
{0 ,14 ,15 ,1 ,13 ,3 ,2 ,12 ,9 ,7 ,6 ,8 ,4 ,10 ,11 ,5 },
{0 ,15 ,13 ,2 ,9 ,6 ,4 ,11 ,1 ,14 ,12 ,3 ,8 ,7 ,5 ,10 },
};

    char Table_S[16][17] = { 
             {0, -1},
             {3, 7, 9, 13, -1},
             {3, 5, 6, 10, 12, 13, 14, -1},
             {1, 3, 4, 6, 7, 10, 11, -1},
             {5, 6, 7, 9, 10, 12, 14, -1},
             {1, 4, 9, 10, 11, 12, 13, -1},
             {2, 6, 8, 11, 12, 15, -1},
             {1, 2, 6, 8, 12, 15, -1},
             {3, 7, 9, 11, 13, 15, -1},
             {2, 4, 6, 8, 12, 14, -1},
             {2, 3, 5, 8, 10, 13, 14, -1},
             {1, 4, 8, 9, 10, 11, 13, -1},
             {2, 5, 7, 8, 9, 10, 14, -1},
             {1, 2, 3, 4, 7, 10, 11, -1},
             {2, 3, 6, 7, 8, 9, 12, 13, -1},
             {1, 4, 14, 15, -1}
         };



int main(){
	srand((unsigned int)time(NULL));
	FILE *maybepath;
	maybepath = fopen("maybepath.txt","w");
	unsigned long long int i;
	int *T; //4*16
	T = (int *)calloc(4,sizeof( int));
	for(i = 0; i < ((unsigned long long int)1<<48); i ++){
		printf("当前验证：%lld\r", i);
		T[0] = (i>>32)%(1<<16);
		T[1] = 0;
		T[2] = (i>>16)%(1<<16);
		T[3] = (i)%(1<<16);
		
		if(test_round(0, T, i) == 0)
			fprintf(maybepath,"找到：%d %d %d %d\n", T[0],T[1],T[2],T[3]);
	}
//	for(i = 0; i < 16; i ++){
//		printf("{");
//		for(j = 0; j < 16; j ++){
//			printf("%d ", GF_mul(i,j));
//			if(j != 15)
//				printf(",");
//			
//		}
//		
//		printf("},\n");
//	}
	return 0; 
} 

int test_round(int deep, int *T, unsigned long long int i){
	
		char deta_A[4], deta_B[4], deta_C[4];
		char S_cnt[4];
		int j, temp;
		
		if(deep == 15){
			return 0;
		}
//		printf("%d ", deep);
		temp = T[1]^T[2]^T[3];
		deta_A[0] = (temp)>>(12);
		deta_A[1] = ((temp)>>(8))%16;
		deta_A[2] =  ((temp)>>(4))%16;
		deta_A[3] = (temp)%16;
		
		for(S_cnt[0] = 0; Table_S[deta_A[0]][S_cnt[0]] != -1; S_cnt[0] ++){
			for(S_cnt[1] = 0; Table_S[deta_A[1]][S_cnt[1]] != -1; S_cnt[1] ++){
				for(S_cnt[2] = 0; Table_S[deta_A[2]][S_cnt[2]] != -1; S_cnt[2] ++){
					for(S_cnt[3] = 0; Table_S[deta_A[3]][S_cnt[3]] != -1; S_cnt[3] ++){
						for(j = 0; j < 4; j ++)
							deta_B[j] = Table_S[deta_A[j]][S_cnt[j]];
						deta_C[0] = Tabel_mul[deta_B[0]][4] ^ Tabel_mul[deta_B[1]][2] ^ Tabel_mul[deta_B[2]][1] ^ Tabel_mul[deta_B[3]][1];
						deta_C[1] = Tabel_mul[deta_B[0]][8] ^ Tabel_mul[deta_B[1]][6] ^ Tabel_mul[deta_B[2]][5] ^ Tabel_mul[deta_B[3]][6];
						deta_C[2] = Tabel_mul[deta_B[0]][0xb] ^ Tabel_mul[deta_B[1]][0xe] ^ Tabel_mul[deta_B[2]][0xa] ^ Tabel_mul[deta_B[3]][9];
						deta_C[3] = Tabel_mul[deta_B[0]][2] ^ Tabel_mul[deta_B[1]][2] ^ Tabel_mul[deta_B[2]][0xf] ^ Tabel_mul[deta_B[3]][0xb];		
						
						temp = T[0];
						T[0] = T[1];
						T[1] = T[2];
						T[2] = T[3];
						T[3] = temp ^ ((deta_C[0]<<12) + (deta_C[1]<<8) + (deta_C[2]<<4) + (deta_C[3]));
						
						switch(deep){
							case 0:{//1111
								if((T[3]>>12) == 0 || ((T[3]>>8)%16) == 0 || ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 1:{//0001 
								if((T[3]>>12) > 0 ||  ((T[3]>>8)%16) > 0  ||  ((T[3]>>4)%16) > 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 2:{//1111
								if((T[3]>>12) == 0 || ((T[3]>>8)%16) == 0 || ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 3:{//1111
								if((T[3]>>12) == 0 || ((T[3]>>8)%16) == 0 || ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 4:{//0001
								if((T[3]>>12) > 0 ||  ((T[3]>>8)%16) > 0  ||  ((T[3]>>4)%16) > 0 || ((T[3]%16) == 0))
									return 1;
								
								break;
							}
							case 5:{//1110
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) > 0))
									return 1;
								break;
							}
							case 6:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 7:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 8:{//1110
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) > 0))
									return 1;
								break;
							}
							case 9:{//0001
								if((T[3]>>12) > 0 ||  ((T[3]>>8)%16) > 0  ||  ((T[3]>>4)%16) > 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 10:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 11:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 12:{//0001
								if((T[3]>>12) > 0 ||  ((T[3]>>8)%16) > 0  ||  ((T[3]>>4)%16) > 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 13:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 14:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
							case 15:{//1111
								if((T[3]>>12) == 0 ||  ((T[3]>>8)%16) == 0  ||  ((T[3]>>4)%16) == 0 || ((T[3]%16) == 0))
									return 1;
								break;
							}
						}
						
						
						//继续下一层 
						
						if(test_round(deep+1, T, i) == 1){
//							printf("%c", 8);
							return 1;
						}
						
						//递归函数 
						
					}
				}
			}
		}
		
		
		return 0;
}





